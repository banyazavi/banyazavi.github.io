---
title: "[OMV6 on HC4] 디스크 마운트 및 공유 폴더 생성"
excerpt: 우선 자료를 담을 바구니를 만들어야 하겠죠. OMV에서 제공하는 기능들을 활용하면 더욱 깔끔하게 만들 수 있습니다.
categories:
  - OMV6 on HC4
sidebar:
  - nav: omv6_nas
tags:
  - NAS
  - OMV6
  - openmediavault
---

이번 글에서는 추가 디스크를 마운트하고 공유 폴더를 만든 다음에, 그룹을 만들어서 공유 폴더에 접근할 권한을 줄 거예요. 이 부분은 폴더를 어떻게 만들어 사용하는지에 따라 설정 방식이 달라질 수 있으니, 어떤 방법으로 접근 권한을 제어하는지 충분히 이해하며 읽어야 합니다.

---

# 저장소 설정

## 디스크 추가

HC4에 슬롯이 하나 남아있죠. 그리고 우리는 디스크 2개를 준비했으니, 남은 하나를 지금 꽂을 때입니다. OMV 패널에서 종료를 눌러 오드로이드를 끈 다음, 나머지 디스크를 꽂고 전원을 다시 연결하여 부팅합니다.

![저장소 > 디스크]({{"/assets/images/2021-12-12/2021-12-12-01-01.png"| relative_url}})

그리고 **저장소 > 디스크**를 들어가 보면, 이렇게 디스크가 추가되어 있습니다. 저는 데비안/OMV를 설치한 `/dev/sda` 디스크에는 잦은 입출력이 발생하는 토렌트나 서비스 데이터를 저장하고, `/dev/sdb` 디스크는 장기 보관하는 자료나 동기화 데이터를 저장할 생각이에요. 혹시나 운영 중 문제가 생겨도 `/dev/sdb` 디스크는 건질 수 있겠죠.

> **[NOTE]**  
> 위에서 설명한 이유로 `/dev/sda` 디스크는 SSD를 사용하는 것도 좋은 생각이에요. ~~그런데 제가 지금 SSD가 없어서...~~  
> 또한, 위의 이유로 실제 `/dev/sdb` 디스크는 10TB의 고용량 디스크를 쓰고 있습니다. 그런데 이 글을 쓰려면 디스크 초기화를 해야 해서...

## 디스크 초기화 및 마운트

![저장소 > 파일 시스템]({{"/assets/images/2021-12-12/2021-12-12-01-02.png"| relative_url}})

이제 **저장소 > 파일 시스템** 메뉴에서 **생성** 버튼을 눌러 `/dev/sdb`를 위한 파일 시스템을 생성합니다. 혹시 이전에 포맷하여 OMV에서 사용한 적이 있는 디스크라면 이 과정을 생략하고 바로 마운트하면 됩니다.

![저장소 > 파일 시스템 > 생성]({{"/assets/images/2021-12-12/2021-12-12-01-03.png"| relative_url}})

여기서 아까 디스크 메뉴에서 확인한 디스크를 추가합니다. 파일 시스템은 일반적으로 **EXT4**를 사용하면 되고, 더 많은 기능을 위해 **BTRFS**를 선택할 수도 있어요. 그 외에도 다양한 포맷이 있으니 인터넷에서 검색하여 적절한 파일 시스템을 선택하면 됩니다. 저는 리눅스에서 가장 대중적인 **EXT4**를 선택했어요.

![파일 시스템 생성]({{"/assets/images/2021-12-12/2021-12-12-01-04.png"| relative_url}})

그러면 위와 같이 디스크를 포맷하기 시작합니다. 다 완료되면 닫기를 눌러 주세요. 그럼 자동으로 마운트 화면으로 넘어갑니다.

![저장소 > 파일 시스템 > 마운트]({{"/assets/images/2021-12-12/2021-12-12-01-05.png"| relative_url}})

그러면 이렇게 마운트할 파티션과 디스크 용량 알림, 디스크 설명을 적을 수 있는 메뉴가 나오는데요. 저는 85% 기본값으로 두고 그냥 저장했어요. 꼼꼼한 성격이라면 설명 부분도 채워 주세요.

![저장소 > 파일 시스템 (마운트 후)]({{"/assets/images/2021-12-12/2021-12-12-01-06.png"| relative_url}})

그러면 이렇게 마운트한 디스크가 표시됩니다. 어, 그런데 `/dev/sda`는 어디에 있죠?

## sharerootfs 설치

`/dev/sda`는 이런 방법으로 마운트할 수 없습니다. 정확하게는 **이미 마운트되어 있는 상태**에요. 그러나 OMV는 **기본적으로 시스템 (데비안) 이 설치된 디스크를 공유 폴더 용도로 사용하지 못하게 해요.** 이 제한을 풀려면 **sharerootfs**라는 플러그인을 설치해야 합니다.

![시스템 > 플러그인 (sharerootfs 설치)]({{"/assets/images/2021-12-12/2021-12-12-01-07.png"| relative_url}})

플러그인은 **시스템 > 플러그인** 메뉴에서 설치할 수 있습니다. 여기에서 **sharerootfs** 플러그인을 찾아 상단의 설치 아이콘을 눌러 설치합니다. 설치가 완료되면 **닫기** 버튼이 활성화되는데요. 버튼을 누르면 보통 화면이 다시 로드됩니다.

![저장소 > 파일 시스템 (sharerootfs 설치 후))]({{"/assets/images/2021-12-12/2021-12-12-01-08.png"| relative_url}})

그리고 나면 이렇게 `/dev/sda` 하위의 파티션인 `/dev/sda2`가 추가된 것을 볼 수 있어요. 이제 모든 디스크의 마운트까지 끝났네요.

# 공유 폴더 설정

이제 공유 폴더를 설정할 수 있어요. 사실 공유 폴더는 여러분의 사용 방식에 따라 다양하게 구성할 수 있는데요. 이번에 설정할 것은 각 디스크의 최상단 공유 폴더를 만드는 거예요. 이 방식은 제 스타일이긴 한데요. 이렇게 디스크별 최상단 공유 폴더를 설정한 뒤, 이후 공유 폴더는 모두 이 최상단 폴더들의 하위 폴더로 구성하면 관리가 편해집니다.

![저장소 > 공유 폴더]({{"/assets/images/2021-12-12/2021-12-12-01-09.png"| relative_url}})

지금은 텅 비어 있는 **저장소 > 공유 폴더** 메뉴에서 **생성** 버튼을 눌러 공유 폴더를 추가합니다.

## Data 공유 폴더 생성

![저장소 > 공유 폴더 > 생성 (data)]({{"/assets/images/2021-12-12/2021-12-12-01-10.png"| relative_url}})

**Data** 공유 폴더는 `/dev/sda` 디스크의 최상단 공유 폴더 역할을 할 거예요. **이름**을 `data`라고 짓고, **파일 시스템**을 `/dev/sda2`, **Releative path**를 `/data`라고 설정합니다. 그럼 OMV를 설치한 데비안의 최상단에 있는 `data`라는 폴더가 생성되어 이 공유 폴더로 기능하게 돼요. 나머지는 기본값으로 두고 저장합니다.

## Archive 공유 폴더 생성

![저장소 > 공유 폴더 > 생성 (archive)]({{"/assets/images/2021-12-12/2021-12-12-01-11.png"| relative_url}})

**Archive** 공유 폴더는 `/dev/sdb` 디스크의 최상단 공유 폴더를 의미합니다. **이름**을 `archive`라고 짓고, **파일 시스템**을 `/dev/sdb1`, **Releative path**를 `/` 라고 설정합니다. 그럼 `/dev/sdb`의 전체 파티션인 `/dev/sdb1`의 최상단 폴더를 지칭하게 됩니다.

이 이후에 생성하는 공유 폴더는 저 두 폴더의 Releative path 하위 경로에 생성하면 됩니다. 그리고 나중에 관리자 계정에 저 두 폴더의 접근 권한만 주어도 모든 공유 폴더에 접근할 수 있게 돼요.

## Archive 공유 폴더의 심볼릭 링크 생성

![저장소 > 공유 폴더 (생성 후)]({{"/assets/images/2021-12-12/2021-12-12-01-12.png"| relative_url}})

그리고 목록을 보면 **data**의 절대 경로는 `/data`로 깔끔하게 나왔지만, **archive**의 절대 경로는 `/srv/dev-disk-by-uuid-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`과 같이 복잡하게 되어 있어요. 이는 이 공유 폴더가 데비안이 설치된 시스템 디스크가 아닌, 추가된 디스크의 공유 폴더라는 것을 의미합니다.

사실, 이 절대 경로를 그대로 사용해도 상관없긴 한데요, 조금 귀찮죠. 특히 나중에 도커 등에서 이 공유 폴더를 참조하고자 할 때 엄청나게 번거롭습니다. 이걸 `/data`와 마찬가지로 `/archive` 이렇게 참조하기 위해서는 심볼릭 링크 (일종의 바로 가기) 설정을 해 줘야 하는데요. 원래는 리눅스에서 사용하는 명령어가 있지만, **OMV에는 같은 역할을 하는 플러그인이 있어요!**

![시스템 > 플러그인 (symlinks 설치)]({{"/assets/images/2021-12-12/2021-12-12-01-13.png"| relative_url}})

바로 **symlinks**라는 플러그인이에요. 이 플러그인을 설치하고 나면, OMV 메뉴에서 심볼릭 링크를 관리할 수 있게 됩니다. 설치 후에 **서비스 > Symlinks** 메뉴가 생긴 것을 볼 수 있어요.

![서비스 > Symlinks]({{"/assets/images/2021-12-12/2021-12-12-01-14.png"| relative_url}})

**서비스 > Symlinks** 메뉴에서 **생성** 버튼을 눌러 심볼릭 링크를 추가해 줍니다.

![서비스 > Symlinks > 생성]({{"/assets/images/2021-12-12/2021-12-12-01-15.png"| relative_url}})

**근원** 부분에 `/srv/dev-disk-by-uuid-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx`에 해당하는 경로를 적고, **대상** 부분에 이 경로를 짧게 표현할 최상단 절대 경로 `/archive`를 적습니다. 한국어 번역이 살짝 이상한 것 같은데요. **근원 (Source)** 이고 **대상 (Destination)** 이에요. ~~아니 이걸 대상이라고 번역하면 어떡해~~

그럼 이제 **Archive** 공유 폴더도 ssh에서 `cd /archive` 이런 식으로 접근할 수 있게 돼요. 이후 글에서는 이 심볼릭 링크가 생성되어 있다고 간주하고, 이 경로를 참조할 거예요.

---

# 그리고 남은... 아니, 했던 이야기

이 글에서 기시감을 느끼는 분도 있을 수 있습니다. 왜냐하면, 사실 [**OMV4 디스크 마운트 및 공유 폴더 설정**](/2019-10-09/디스크-마운트-및-공유-폴더-설정) 글과 큰 차이가 없거든요. OMV가 버전에 따른 디자인 차이가 있을 뿐, 사용법은 크게 달라지지 않은 이유일 거예요. 사실, 이후 글도 OMV4와 크게 다르지 않을 것 같아요. (도커 설치 전까지) 하지만 이번 시리즈에서는 2년 동안 OMV를 쓰며 찾아낸 여러 플러그인 사용법, 설정 팁을 더 소개해 보도록 할게요.
